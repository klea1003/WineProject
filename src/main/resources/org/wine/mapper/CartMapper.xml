<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.wine.mapper.CartMapper">


	<select id="getList" resultType="org.wine.domain.CartVO">
		<![CDATA[
		select*from tbl_cart_test where CART_NUM > 0
		]]>
	</select>
	
	<insert id = "insert">
	insert into tbl_cart_test(CART_NUM, USER_NUM, SELLER_NUM, WNO, CART_QTY)
	VALUES( SEQ_CART_TEST.NEXTVAL, #{userNum}, #{sellerNum}, #{wno}, #{cartQty})
	</insert>
	


	<!--장바구니 추가 -->
	<insert id="insertCart">
		insert into tbl_cart_test(
		CART_NUM, USER_NUM, SELLER_NUM, WNO, CART_QTY
		)values(
		SEQ_CART_TEST.NEXTVAL, #{userNum}, #{sellerNum}, #{wno}, #{cartQty}
		)
	</insert>


	<!-- 장바구니 목록 -->
	<select id = "listCart" resultType="org.wine.domain.CartVO">
	select CART_NUM, USER_NUM, USER_REALNAME, SELLER_NUM, SELLER_ID,
	WNO, TITLE, PRICE, CART_QTY, (PRICE*CART_QTY)TOTAL_PRICE
	from
	TBL_USER_TEST U, TBL_CART_TEST C, TBL_SELLER_TEST S
	where
	U.USER_ID = C.USER_ID and C.WNO = W.WNO and C.SELLER_NUM = S.SELLER_NUM
	and C.USER_NUM=#{userNum} order by CART_NUM
	</select>
	
	
	<!-- 장바구니 전체 금액 -->
	<select id="sumTotalPrice" resultType="int">
	select NVL(SUM(PRICE*CART_QTY),0) TOTAL_PRICE
	from
	TBL_CART_TEST C, TBL_WINE_TEST W
	where
	C.WNO = W.WNO and C.USER_NUM = #{userNum}
	</select>
	
	<!-- 장바구니 수정 -->
	<update id = "modifyCart">
	update TBL_CART_TEST
	set CART_QTY = #{cartQty}
	WHERE USER_NUM = #{userNum}
	AND SELLER_NUM = #{sellerNum}
	AND WNO = #{wno}
	</update>
	
	<!-- 장바구니 삭제 -->
	<delete id ="deleteCart">
	delete from TBL_CART_TEST
	where CART_NUM = #{cartNum}
	</delete>
	
	<!-- 장바구니 동일상품 확인 -->
	<select id = "countCart" resultType="int">
	select count(*)
	from TBL_CART_TEST
	where USER_NUM = #{userNum}
	and SELLER_NUM = #{sellerNum}
	and WNO = #{wno}</select>
	
	<!-- 동일상품 존재할 경우 수량 수정 -->
	<update id = "updateCart">
	update TBL_CART_TEST
	set CART_QTY = CART_QTY + #{cartQty}
	where USER_NUM = #{userNum}
	and SELLER_NUM = #{sellerNum}
	and WNO = #{wno}
	</update>




</mapper>
 